{% extends "base.html" %}
{% set hide_header = true %}

{% block title %}Chat - Yuzu Companion{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/sidebar.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
<!-- Highlight.js for syntax highlighting -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
{% endblock %}

{% block content %}
<!-- Sidebar -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <h2>Yuzu Companion</h2>
        <button class="close-sidebar" onclick="toggleSidebar()">√ó</button>
    </div>
    
    <div class="sidebar-content">
        <!-- Navigation -->
        <div class="sidebar-section">
            <h3>Navigation</h3>
            <a href="/" class="sidebar-link">
                <span>üè†</span> Home
            </a>
            <a href="/chat" class="sidebar-link active">
                <span>üí¨</span> Chat
            </a>
            <a href="/config" class="sidebar-link">
                <span>‚öôÔ∏è</span> Config
            </a>
            <a href="/about" class="sidebar-link">
                <span>‚ÑπÔ∏è</span> About
            </a>
        </div>
        
        <!-- Theme Selector -->
        <div class="sidebar-section">
            <h3>Theme</h3>
            <select class="theme-select" id="themeSelect" onchange="changeTheme(this.value)">
                <option value="dark">Dark Blue</option>
                <option value="light">Soft Light</option>
                <option value="lavender">Pastel Lavender</option>
                <option value="mint">Pastel Mint</option>
                <option value="peach">Pastel Peach</option>
                <option value="dark-lavender">Dark Lavender</option>
                <option value="vanilla-orange">Vanilla Orange</option>
            </select>
        </div>
        
        <!-- Session Management -->
        <div class="sidebar-section">
            <h3>Sessions</h3>
            <button class="sidebar-btn" onclick="createNewSession()">
                <span>‚ûï</span> New Chat
            </button>
            <div class="sessions-list" id="sessionsList">
                <div class="loading">Loading sessions...</div>
            </div>
        </div>
    </div>
</div>

<!-- Sidebar Overlay -->
<div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

<div class="chat-layout">
    <div class="chat-header">
        <div class="header-left">
            <button class="hamburger-menu-inline" onclick="toggleSidebar()">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="header-info">
                <div class="assistant-name">{{ profile.partner_name }}</div>
                <div class="session-name" id="sessionName">Active Session</div>
            </div>
        </div>
        <div class="header-right">
            <div class="affection-bar-container">
                <div class="affection-label">{{ profile.affection }}%</div>
                <div class="affection-bar">
                    <div class="affection-fill" style="width: {{ profile.affection }}%"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="chat-container" id="chatContainer">
        <!-- Messages will be inserted here -->
    </div>

    <div id="typingIndicator" class="typing-indicator hidden">
        <span></span>
        <span></span>
        <span></span>
    </div>

    <div class="input-area">
        <textarea id="messageInput" placeholder="Type your message (Ctrl+Enter to send)..." rows="1"></textarea>
        <button id="sendButton">Send</button>
    </div>

    <button id="scrollToBottom" class="hidden">‚Üì</button>
</div>
{% endblock %}

{% block scripts %}
<!-- markdown-it library (required by project rules) -->
<script src="https://unpkg.com/markdown-it@14/dist/markdown-it.min.js"></script>
<!-- Highlight.js for syntax highlighting -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="{{ url_for('static', filename='js/renderer.js') }}"></script>
<script src="{{ url_for('static', filename='js/sidebar.js') }}"></script>
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}
