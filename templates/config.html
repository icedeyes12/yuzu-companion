{% extends "base.html" %}

{% block title %}Configuration - Yuzu Companion{% endblock %}

{% block content %}
<article>
    <header>
        <h1>Configuration</h1>
        <p>Customize your Yuzu Companion experience</p>
    </header>

    <section>
        <h2>Profile Settings</h2>
        <form id="profileForm">
            <label for="display-name">
                Your Display Name:
                <input type="text" id="display-name" name="display-name" value="{{ profile.display_name }}" required>
            </label>

            <label for="partner-name">
                Partner Name:
                <input type="text" id="partner-name" name="partner-name" value="{{ profile.partner_name }}" required>
            </label>

            <label for="affection-level">
                Affection Level (0-100): <span id="affection-value">{{ profile.affection }}</span>
                <input type="range" id="affection-level" name="affection-level" min="0" max="100" value="{{ profile.affection }}">
            </label>

            <button type="submit" id="save-profile">Save Profile Settings</button>
        </form>
    </section>

    <section>
        <h2>AI Provider Settings</h2>
        <form id="providerForm">
            <label for="ai-provider">
                Preferred AI Provider:
                <select id="ai-provider" name="ai-provider" required>
                    <option value="">Loading providers...</option>
                </select>
            </label>

            <label for="ai-model">
                Preferred Model:
                <select id="ai-model" name="ai-model" required>
                    <option value="">Select provider first...</option>
                </select>
            </label>

            <div id="provider-status" style="padding: 1rem; background: var(--card-background-color); border-radius: var(--border-radius); margin: 1rem 0;">
                <p><strong>Current:</strong> <span id="current-provider">Loading...</span></p>
                <p><strong>Status:</strong> <span id="connection-status">Checking...</span></p>
            </div>

            <div role="group">
                <button type="button" id="test-provider" class="secondary">Test Connection</button>
                <button type="submit" id="save-provider">Save Provider Settings</button>
            </div>
        </form>
    </section>

    <section>
        <h2>Session Context</h2>
        <div id="session-context" style="padding: 1rem; background: var(--card-background-color); border-radius: var(--border-radius); margin: 1rem 0; min-height: 60px;">
            Loading session context...
        </div>
        <p><small><strong>Last Updated:</strong> <span id="session-last-updated">Loading...</span></small></p>
        
        <div role="group">
            <button type="button" id="update-session-context" class="secondary">Update Session Context</button>
            <button type="button" id="clear-chat-history" class="contrast">Clear Chat History</button>
        </div>
    </section>

    <section>
        <h2>Global Player Profile</h2>
        <p><small>Comprehensive profile from ALL sessions</small></p>
        <div id="global-profile" style="padding: 1rem; background: var(--card-background-color); border-radius: var(--border-radius); margin: 1rem 0;">
            <p><strong>Summary:</strong> <span id="player-summary">Loading...</span></p>
            <p><strong>Likes:</strong> <span id="player-likes">Loading...</span></p>
            <p><strong>Dislikes:</strong> <span id="player-dislikes">Loading...</span></p>
            <p><strong>Personality:</strong> <span id="player-personality">Loading...</span></p>
            <p><strong>Memories:</strong> <span id="player-memories">Loading...</span></p>
            <p><strong>Relationship:</strong> <span id="player-relationship">Loading...</span></p>
        </div>
        <p><small><strong>Last Updated:</strong> <span id="global-profile-last-updated">Never</span></small></p>
        
        <button type="button" id="update-global-profile">Update Global Profile (All Sessions)</button>
    </section>

    <section>
        <h2>Global Knowledge</h2>
        <p><small>Manual facts that persist across all sessions</small></p>
        <label for="global-knowledge">
            <textarea id="global-knowledge" name="global-knowledge" placeholder="Enter global facts about yourself/partner that should be remembered across ALL sessions..." rows="6"></textarea>
        </label>
        <button type="button" id="save-global-knowledge">Save Global Knowledge</button>
    </section>

    <section>
        <h2>API Keys</h2>
        <form id="apiKeyForm">
            <label for="api-key-provider">
                Provider:
                <select id="api-key-provider" name="api-key-provider">
                    <option value="openrouter">OpenRouter</option>
                    <option value="cerebras">Cerebras</option>
                    <option value="chutes">Chutes</option>
                </select>
            </label>

            <label for="api-key">
                API Key:
                <input type="text" id="api-key" name="api-key" placeholder="Enter your API key">
            </label>
            
            <button type="submit" id="add-api-key">Add API Key</button>
        </form>
        
        <details style="margin-top: 1rem;">
            <summary><strong>Stored API Keys</strong></summary>
            <ul id="keys-list">
                <li>Loading...</li>
            </ul>
        </details>
    </section>
</article>

<script src="{{ url_for('static', filename='js/config.js') }}"></script>
{% endblock %}

{% block extra_js %}
<script>
// Update affection value display
document.getElementById('affection-level').addEventListener('input', function() {
    document.getElementById('affection-value').textContent = this.value;
});
</script>
{% endblock %}
